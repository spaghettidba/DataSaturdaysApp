@using Microsoft.AspNetCore.Components.Forms;
@using DataSaturdays.Core.Entities;
@using DataSaturdays.Core.Services;
@using Microsoft.JSInterop;

@inject IEventService EventService
@inject IJSRuntime JSRuntime

<EditForm EditContext="_editContext" OnValidSubmit="Save" class="row mr-5 ml-5">
        
    <div class="col-6 pt-3 offset-3 highlight">

        <!-- START OBLIGATORY -->
        <div data-view-component="true" class="Subhead Subhead--spacious col-6 offset-3">
            <h2 id="profile-settings-heading" data-view-component="true" class="Subhead-heading">Standard infos</h2>
        </div>
        <div class="row mt-lg-5">
                
            <div class="col-6">
                <div class="form-group">
                    <label for="txtName">Name</label>
                    <InputText class="form-control" title="Name" @bind-Value="Item.Name" placeholder="Enter event name" required />
                </div>
            </div>
        

            <div class="col-4">
                <div class="form-group">
                    <label for="txtDate">Date</label>
                    <InputDate class="form-control" title="Date" @bind-Value="Item.Date" placeholder="Enter event date" required />
                </div>
            </div>

            <div class="col-2">
                <div class="col align-content-center form-check">
                    <label for="checkboxVir" class="form-check-label"> Virtual</label>
                    <InputCheckbox type="checkbox" class="form-check-input checkbox-size mt-5 pt-md-5" @bind-Value="Item.Virtual" title="Virtual" id="checkboxVir" />
                </div>
            </div>

            <div class="col-12 mt-3">
                <div class="form-group">
                    <label for="txtDescription">Description</label>
                    <InputTextArea type="text" class="form-control" title="Description" rows="10" @bind-Value="Item.Description" placeholder="Enter event description" required ></InputTextArea>
                </div>
            </div>
        </div>

        <br/>

        <div class="row">
            <div class="col-12">
                <div class="form-group">
                    <label for="urlReg">Registration URL</label>
                    <InputText type="url" class="form-control" title="RegURL" @bind-Value="Item.RegistrationURL" placeholder="Enter the registration URL" />
                </div>
            </div>


            <div class="col-12">
                <div class="form-group">
                    <label for="urlCFS">Call For Speaker URL</label>
                    <InputText type="url" class="form-control" title="CFSURL" @bind-Value="Item.CallForSpeakersURL" placeholder="Enter the call for speaker URL" />
                </div>
            </div>

            <div class="col-12">
                <div class="form-group">
                    <label for="urlSchedule">Schedule URL</label>
                    <InputText type="url" class="form-control" title="ScheduleURL" @bind-Value="Item.ScheduleURL" placeholder="Enter the schedule URL" />
                </div>
            </div>
        </div>

        <br />

        <div class="row">
            <div class="col-12">
                <div class="form-group">
                    <label for="urlSpeakerList">Speaker List URL</label>
                    <InputText type="url" class="form-control" title="SpeakerListURL" @bind-Value="Item.SpeakerListURL" placeholder="Enter the speaker list URL" />
                </div>
            </div>


            <div class="col-12">
                <div class="form-group">
                    <label for="urlVolunteer">Volunteers URL</label>
                    <InputText type="url" class="form-control" title="VolURL" @bind-Value="Item.VolunteerRequestURL" placeholder="Enter the volunteer request URL" />
                </div>
            </div>

            <div class="col-12">
                <div class="form-group">
                    <label for="urlMap">Venue Map URL</label>
                    <InputText type="url" class="form-control" title="VMapURL" @bind-Value="Item.VenueMap" placeholder="Enter the venue URL" />
                </div>
            </div>
        </div>

    </div>

    <br />

    <!-- START ORGANIZERS -->
    <div class="col-6 pt-5 offset-3 highlight">
        <div data-view-component="true" class="Subhead Subhead--spacious col-6 offset-3">
            <h2 id="profile-settings-heading" data-view-component="true" class="Subhead-heading">Organizers</h2>
        </div>
        @if (Item.Organizers?.Any() == true)
        {
            @foreach (var Org in Item.Organizers)
            {
                <div class="row mt-lg-5">

                    <div class="col-4">
                        <div class="form-group">
                            <label for="txtOName">Organizer Name</label>
                            <input type="text" class="form-control" title="OName" value="@Org.Name" />
                        </div>
                    </div>

                    <div class="col-4">
                        <div class="form-group">
                            <label for="urlOEmail">Organizer's email</label>
                            <input type="email" class="form-control" title="OrgEmail" value="@Org.Email" />
                        </div>
                    </div>

                    <div class="col-4">
                        <div class="form-group">
                            <label for="urlOTwitt">Organizer's Twitter Tag</label>
                            <input type="text" class="form-control" title="OrgTwitt" value="@Org.Twitter" />
                        </div>
                    </div>
                </div>
            }
        }

    </div>
    <!-- END ORGANIZERS -->

    <!-- END OBLIGATORY -->
        
    <br>

    <!-- START MILESTONES -->
    <div class="col-6 pt-3 offset-3 highlight">
        <div data-view-component="true" class="Subhead Subhead--spacious col-6 offset-3">
            <h2 id="profile-settings-heading" data-view-component="true" class="Subhead-heading">Milestones</h2>
        </div>
        @if (Item.Milestones?.Any() == true)
        {
            @foreach (var Mil in Item.Milestones)
            {
                <div class="row mt-lg-5">

                    <div class="col-4">
                        <div class="form-group">
                            <label for="txtMName">Milestone Name</label>
                            <input type="text" class="form-control" title="MName" value="@Mil.Name" />
                        </div>
                    </div>


                    <div class="col-4">
                        <div class="form-group">
                            <label for="txtMDate">Milestone Date</label>
                            <input type="text" class="form-control" title="MDate" value="@Mil.Date" />
                        </div>
                    </div>

                    <div class="col-4">
                        <div class="form-group">
                            <label for="txtMOrder">Milestone Order</label>
                            <input type="text" class="form-control" title="MOrder" value="@Mil.Order" />
                        </div>
                    </div>

                </div>
            }
        }
        else
        {
            <div class="col-10 offset-1 text-center">
                <button type="button" class="btn btn-primary mt-3 mr-3 align-content-center">Add Item</button>             
            </div>
        }
    </div>
    <!-- END MILESTONES -->

    <br />

    <!-- START PRECONFERENCE -->
    <div class="col-6 pt-3 offset-3 highlight">
        <div data-view-component="true" class="Subhead Subhead--spacious col-6 offset-3">
            <h2 id="profile-settings-heading" data-view-component="true" class="Subhead-heading">Peconference</h2>
        </div>

        <div class="row mt-lg-5">

            <div class="col-12">
                <div class="form-group">
                    <label for="txtPName">Preconference Name</label>
                    <input type="text" class="form-control" title="PreconName" value=""/>
                </div>
            </div>


            <div class="col-12 mt-3">
                <div class="form-group">
                    <label for="txtPrecDescription">Precon Description</label>
                    <InputTextArea type="text" class="form-control" title="Precon Description" rows="8" @bind-Value="Item.PreconDescription" placeholder="Enter precon description"></InputTextArea>
                </div>
            </div>

            @if (Item.Precons?.Any() == true)
            {
                @foreach (var Speaker in Item.Precons)
                {
                    <div class="col-4">
                        <div class="form-group">
                            <label for="txtSName">Speaker Name</label>
                            <input type="text" class="form-control" title="SName" value="@Speaker.Name" />
                        </div>
                    </div>

                    <div class="col-4">
                        <div class="form-group">
                            <label for="urlSpeaker">Speaker URL</label>
                            <input type="url" class="form-control" title="SURL" value="" />
                        </div>
                    </div>

                    <div class="col-4">
                        <div class="form-group">
                            <label for="urlSpeakerimg">Speaker Image URL</label>
                            <input type="url" class="form-control" title="SImgURL" value="" />
                        </div>
                    </div>
                }
            }
            else
            {
                <div class="col-10 offset-1 text-center">
                    <button type="button" class="btn btn-primary mt-3 mr-3 align-content-center">Add Item</button>
                </div>
            }
        </div>
    </div>
    <!-- END PRECONFERENCE -->

    <br />

    <!-- START SPONSORS -->
    <div class="col-6 pt-3 offset-3 highlight">
        <div data-view-component="true" class="Subhead Subhead--spacious col-6 offset-3">
            <h2 id="profile-settings-heading" data-view-component="true" class="Subhead-heading">Sponsors</h2>
        </div>

        <div class="col-12 mt-3">
            <div class="col align-content-center form-check">
                <label for="checkboxSponsorBens" class="form-check-label">Sponsor Benefits</label>
                <InputTextArea type="text" class="form-control" rows="5" @bind-Value="Item.SponsorBenefits" title="SponsorBenefits" placeholder="Enter description for the sponsors benefits"></InputTextArea>
            </div>
        </div>

        <div class="col-4">
            <div class="col text-center form-check">
                <InputCheckbox type="checkbox" class="form-check-input checkbox-size" @bind-Value="Item.SponsorMenuItem" title="SponsorMenu" id="checkboxSponsMen" />
                <label for="checkboxVir" class="form-check-label">Sponsor Menu Item</label>
            </div>
        </div>

        @if (Item.Sponsors?.Any() == true)
        {
            @foreach (var Spon in Item.Sponsors)
            {

                <div class="row mt-lg-5">

                    <div class="col-3">
                        <div class="form-group">
                            <label for="txtSName">Sponsor Name</label>
                            <input type="text" class="form-control" title="SName" value="@Spon.Name" />
                        </div>
                    </div>


                    <div class="col-3">
                        <div class="form-group">
                            <label for="urlSImg">Sponsor Image</label>
                            <input type="url" class="form-control" title="SImg" value="@Spon.ImageURL" />
                        </div>
                    </div>

                    <div class="col-3">
                        <div class="form-group">
                            <label for="urlSLink">Sponsor Link</label>
                            <input type="url" class="form-control" title="SLink" value="@Spon.LinkURL" />
                        </div>
                    </div>

                    <div class="col-3">
                        <div class="form-group">
                            <label for="txtSLevel">Sponsor Level</label>
                            <input type="text" class="form-control" title="SLevel" value="@Spon.Level" />
                        </div>
                    </div>

                </div>
            }
        }
        else
        {
            <div class="col-10 offset-1 text-center">
                <button type="button" class="btn btn-primary mt-3 mr-3 align-content-center">Add Item</button>
            </div>
        }
    </div>
    <!-- END SPONSORS -->

    <br />

    <!-- START VIRTUAL --!>
    <div class="row mt-lg-5 mt-5 ">
        <div class="col-6 pt-3 offset-3 highlight">
            <div data-view-component="true" class="Subhead Subhead--spacious col-6 offset-3">
                <h2 id="profile-settings-heading" data-view-component="true" class="Subhead-heading">Rooms</h2>
            </div>

            @if (Item.Rooms?.Any() == true)
            {
                @foreach (var Room in Item.Rooms)
                {
                    <div class="col-6">
                        <div class="form-group">
                            <label for="txtRName">Room Name</label>
                            <input type="text" class="form-control" title="RName" value="@Room.Name"/>
                        </div>
                    </div>

                    <div class="col-6">
                        <div class="form-group">
                            <label for="urlRoom">Room URL</label>
                            <input type="url" class="form-control" title="RoomURL" value="@Room.JoinURL" />
                        </div>
                    </div>
                }
            }
            else
            {
                <div class="col-10 offset-1 text-center">
                    <button type="button" class="btn btn-primary mt-3 mr-3 align-content-center">Add Item</button>
                </div>
            }
        </div>
    </div>
    <!-- END VIRTUAL -->

    <br />

    <!-- START OTHER -->
    <div class="col-6 pt-3 offset-3 highlight">
        <div data-view-component="true" class="Subhead Subhead--spacious col-6 offset-3">
            <h2 id="profile-settings-heading" data-view-component="true" class="Subhead-heading">Other</h2>
        </div>

        <div class="row mt-lg-5">

            <div class="col-4">
                <div class="col align-content-center form-check">
                    <InputCheckbox type="checkbox" class="form-check-input checkbox-size" @bind-Value="Item.HideTopLogo" title="HTL" id="checkboxHTL" />
                    <label for="checkboxHTL" class="form-check-label">Hide top Logo</label>
                </div>
            </div>



            <div class="col-4">
                <div class="col align-content-center form-check">
                    <InputCheckbox type="checkbox" class="form-check-input checkbox-size" @bind-Value="Item.HideJoinRoom" title="HJR" id="checkboxHJR" />
                    <label for="checkboxHJR" class="form-check-label">Hide Join Rooms</label>
                </div>
            </div>

            <div class="col-4">
                <div class="col align-content-center form-check">
                    <InputCheckbox type="checkbox" class="form-check-input checkbox-size" @bind-Value="Item.OpenRegistrationNewTab" title="OpenRegNew" id="checkboxORNT" />
                    <label for="checkboxORNT" class="form-check-label">Open Registration in a new tab</label>
                </div>
            </div>

            <div class="col-12 mt-3">
                <div class="col align-content-center form-check">
                    <label for="checkboxCOC" class="form-check-label">Code of Conduct</label>
                    <InputTextArea type="text" class="form-control" rows="5" @bind-Value="Item.CodeOfConduct" title="COC" placeholder="Enter Code of Conduct"></InputTextArea>
                </div>
            </div>
            
            <div class="col-12 mt-3">
                <div class="col align-content-center form-check">
                    <label for="txtSDescription">Schedule Description</label>
                    <InputTextArea type="text" class="form-control" title="Schedule description" rows="5" @bind-Value="Item.ScheduleDescription" placeholder="Enter schedule description"></InputTextArea>
                </div>
            </div>

            <div class="col-12 mt-3">
                <div class="col align-content-center form-check">
                    <label for="txtScheduleApp">Schedule App URL</label>
                    <InputText type="text" class="form-control" title="Schedule App" @bind-Value="Item.ScheduleApp" placeholder="Enter schedule App URL" />
                </div>
            </div>

        </div>
    </div>
    <!-- END OTHER -->
    <div class="col-10 offset-1 text-center">      
       <button type="submit" class="btn btn-primary mt-3 mr-3 align-content-center">Save</button>
       <a class="btn btn-outline-primary mt-3 align-content-center" href="/Dashboard">Cancel</a>        
    </div>

    @if (IsSaved)
    {
        <div class="col-10 offset-1 text-center">
            <p>
                Update successfull
            </p>
        </div>
    }


</EditForm>


@code {
    [Parameter] public Guid Id { get; set; }

    public Event Item { get; set; } = new Event();

    private EditContext _editContext = new EditContext(new Event());

    private bool IsSaved { get; set; } = false;

    protected override async Task OnInitializedAsync()
    {
        try
        {
            Item = await EventService.GetEventByIdAsync(Id);
            
            if (Item == null)
            {
                Item = new Event();
            }

            _editContext = new EditContext(Item);
        }
        catch(Exception ex)
        {
            Console.WriteLine(ex.Message);
        }
    }

    protected async Task Save()
    {
        try
        {
            if (Item.Id.Equals(Guid.Empty))
            {
                await EventService.CreateEvent(Item);
                await JSRuntime.InvokeVoidAsync("history.back");
            }
            else
            {
                await EventService.UpdateEvent(Item);
                IsSaved = true;
            }
        }
        catch (Exception ex)
        {
            Console.WriteLine(ex.Message);
        }
    }
}
